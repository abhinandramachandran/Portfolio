<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Awesome To-Do List</title>
    <!-- Tailwind CSS CDN for modern styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* CSS Variables for Neon Colors */
        /* These will be overridden by theme-specific classes on the body */
        :root {
            --neon-blue: #00e5ff;
            --neon-blue-glow: #00b0ff;
            --neon-pink: #ff00ff;
            --neon-pink-glow: #e000e0;
            --neon-green: #00ff00;
            --neon-green-glow: #00cc00;
            --neon-orange: #ff9900;
            --neon-orange-glow: #e68a00;
            --text-color-dark: #333;
            --text-color-light: #ecf0f1;
            --bg-dark-base: #1a1a2e; /* A very dark background for contrast */

            /* Default theme colors (will be set by theme-ocean-breeze initially) */
            --theme-primary-neon: var(--neon-blue);
            --theme-secondary-neon: var(--neon-pink);
            --theme-primary-glow: var(--neon-blue-glow);
            --theme-secondary-glow: var(--neon-pink-glow);
        }

        /* Custom Fonts and Base Body Styles */
        body {
            font-family: 'Inter', sans-serif;
            display: flex;
            flex-direction: column; /* Changed to column to stack card and footer */
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
            background-size: cover;
            background-position: center;
            transition: background 0.8s ease-in-out; /* Smooth background transitions */
            position: relative; /* Needed for ::after pseudo-element */
            overflow: hidden; /* Ensure background animations don't cause scrollbars */
        }

        /* Animations */
        @keyframes fadeInSlideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOutSlideRight {
            to { opacity: 0; transform: translateX(100px); }
        }

        /* Text glow animation - uses theme-specific glow colors */
        @keyframes textFlash {
            0% { text-shadow: 0 0 5px var(--theme-primary-glow), 0 0 10px var(--theme-primary-glow); }
            50% { text-shadow: 0 0 15px var(--theme-primary-glow), 0 0 30px var(--theme-primary-glow); }
            100% { text-shadow: 0 0 5px var(--theme-primary-glow), 0 0 10px var(--theme-primary-glow); }
        }

        /* Generic neon glow pulse for elements - NOW USES THEME COLORS */
        @keyframes neonGlowPulse {
            0%, 100% { box-shadow: 0 0 5px var(--theme-primary-glow), 0 0 15px var(--theme-secondary-glow); }
            50% { box-shadow: 0 0 10px var(--theme-primary-glow), 0 0 25px var(--theme-secondary-glow); }
        }

        /* Background pulse animation - affects size for breathing effect */
        @keyframes backgroundPulse {
            0%, 100% { background-size: 100% 100%; }
            50% { background-size: 115% 115%; } /* More pronounced pulse */
        }

        /* Button hover pulse animation */
        @keyframes button-pulse {
            0% { transform: translateY(-2px); box-shadow: 0 0 15px var(--theme-primary-glow), 0 0 25px var(--theme-primary-glow); }
            50% { transform: translateY(-3px); box-shadow: 0 0 20px var(--theme-primary-glow), 0 0 35px var(--theme-primary-glow); }
            100% { transform: translateY(-2px); box-shadow: 0 0 15px var(--theme-primary-glow), 0 0 25px var(--theme-primary-glow); }
        }

        /* --- Unique Background Animations for each theme --- */

        /* Ocean Wave Effect */
        @keyframes wave {
            0% { background-position: 0% 0%; }
            100% { background-position: 100% 100%; }
        }
        body.theme-ocean-breeze {
            background: linear-gradient(135deg, #001a35, #003366, #004d99); /* Deeper, richer ocean blue */
            animation: backgroundPulse 12s infinite alternate; /* Slower, smoother pulse */
            --theme-primary-neon: #00e5ff; /* Cyan */
            --theme-secondary-neon: #007bff; /* Bright Blue */
            --theme-primary-glow: #00b0ff;
            --theme-secondary-glow: #0056b3;
        }
        body.theme-ocean-breeze .theme-overlay {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: radial-gradient(circle at 20% 80%, rgba(0, 100, 200, 0.2) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(0, 150, 255, 0.2) 0%, transparent 50%);
            background-size: 300% 300%;
            animation: wave 20s linear infinite;
            opacity: 0.7;
            pointer-events: none; /* Allows clicks to pass through */
        }

        /* Sunset Ray Effect */
        @keyframes sunRay {
            0% { transform: rotate(0deg); opacity: 0.5; }
            50% { transform: rotate(180deg); opacity: 0.7; }
            100% { transform: rotate(360deg); opacity: 0.5; }
        }
        body.theme-sunset-glow {
            background: linear-gradient(135deg, #330000, #800000, #ff4500); /* Fiery red/orange sunset */
            animation: backgroundPulse 12s infinite alternate;
            --theme-primary-neon: #ff9900; /* Orange */
            --theme-secondary-neon: #ff4500; /* Red-Orange */
            --theme-primary-glow: #e68a00;
            --theme-secondary-glow: #cc3700;
        }
        body.theme-sunset-glow .theme-overlay {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: conic-gradient(from 0deg at 50% 50%, 
                        rgba(255, 100, 0, 0.3) 0deg, 
                        rgba(255, 150, 0, 0.1) 45deg, 
                        transparent 90deg, 
                        rgba(255, 150, 0, 0.1) 135deg, 
                        rgba(255, 100, 0, 0.3) 180deg, 
                        transparent 270deg, 
                        rgba(255, 100, 0, 0.3) 360deg);
            animation: sunRay 25s linear infinite;
            opacity: 0.8;
            pointer-events: none;
        }

        /* Night Starfield Effect */
        @keyframes twinkle {
            0%, 100% { opacity: 0; }
            50% { opacity: 1; }
        }
        body.theme-deep-night {
            background: linear-gradient(135deg, #0a0a0f, #1a1a2e, #2c3e50); /* Darker, more mysterious night */
            animation: backgroundPulse 12s infinite alternate;
            --theme-primary-neon: #b300b3; /* Magenta */
            --theme-secondary-neon: #6a0dad; /* Dark Purple */
            --theme-primary-glow: #cc00cc;
            --theme-secondary-glow: #5f0bae;
        }
        body.theme-deep-night .theme-overlay {
            content: '';
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 75% 80%, white, transparent),
                radial-gradient(2px 2px at 50% 10%, white, transparent),
                radial-gradient(1px 1px at 90% 50%, white, transparent),
                radial-gradient(1px 1px at 10% 60%, white, transparent),
                radial-gradient(1px 1px at 40% 90%, white, transparent);
            background-size: 300px 300px, 400px 400px, 500px 500px, 600px 600px, 700px 700px, 800px 800px;
            animation: twinkle 5s infinite alternate;
            opacity: 0.6;
            pointer-events: none;
        }

        /* Forest Particle Effect */
        @keyframes forestParticles {
            0% { transform: translateY(0) translateX(0); opacity: 0.8; }
            50% { transform: translateY(-50px) translateX(20px); opacity: 0.6; }
            100% { transform: translateY(-100px) translateX(-20px); opacity: 0; }
        }
        body.theme-forest-green {
            background: linear-gradient(135deg, #003300, #006600, #009900); /* Lush, vibrant forest green */
            animation: backgroundPulse 12s infinite alternate;
            --theme-primary-neon: #00ff00; /* Lime Green */
            --theme-secondary-neon: #32cd32; /* Green-Yellow */
            --theme-primary-glow: #00cc00;
            --theme-secondary-glow: #28a745;
        }
        body.theme-forest-green .theme-overlay {
            content: '';
            position: absolute;
            top: 100%; left: 0; width: 100%; height: 100%; /* Start from bottom */
            background: 
                radial-gradient(2px 2px at 10% 50%, var(--theme-primary-glow), transparent),
                radial-gradient(2px 2px at 80% 20%, var(--theme-secondary-glow), transparent),
                radial-gradient(3px 3px at 30% 70%, var(--theme-primary-glow), transparent);
            background-size: 100px 100px; /* Smaller particles */
            animation: forestParticles 10s infinite linear;
            opacity: 0.5;
            filter: blur(1px); /* Soft glow */
            pointer-events: none;
        }


        /* To-Do Card Styling with subtle overall neon glow */
        .todo-card {
            background-color: rgba(0, 0, 0, 0.7); /* Darker, more transparent for neon */
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 15px var(--theme-primary-glow), 0 0 30px rgba(0,0,0,0.5); /* Overall card glow uses theme colors */
            width: 100%;
            max-width: 600px;
            animation: fadeIn 0.5s ease-out;
            border: 2px solid var(--theme-primary-neon); /* Neon border uses theme colors */
            position: relative;
            overflow: hidden; /* For task animations */
        }
        .todo-card::before { /* For an inner pulsating glow */
            content: '';
            position: absolute;
            top: -5px; bottom: -5px; left: -5px; right: -5px;
            background: linear-gradient(45deg, var(--theme-primary-neon), var(--theme-secondary-neon)); /* Uses theme colors */
            filter: blur(20px);
            opacity: 0.2;
            z-index: -1;
            animation: neonGlowPulse 5s infinite ease-in-out; /* Animation is generic, colors come from theme */
        }

        /* Main Title Neon Effect */
        h1 {
            color: var(--theme-primary-neon);
            text-shadow: 
                0 0 5px var(--theme-primary-glow),
                0 0 10px var(--theme-primary-glow),
                0 0 20px var(--theme-primary-glow),
                0 0 40px var(--theme-secondary-glow), /* Added color depth from secondary */
                0 0 80px var(--theme-secondary-glow);
            letter-spacing: 2px;
            animation: textFlash 3s infinite alternate; /* Pulsing text glow */
        }

        /* Theme Buttons */
        .theme-buttons button {
            background-color: rgba(0, 0, 0, 0.5);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
            position: relative;
            z-index: 1;
            overflow: hidden;
        }
        .theme-buttons button:hover {
            /* These specific hover colors still apply */
            transform: scale(1.05);
            animation: neonGlowPulse 1.5s infinite alternate;
        }
        /* Specific theme button glows for hover state */
        .theme-buttons button[data-theme="ocean-breeze"]:hover { border-color: var(--neon-blue); box-shadow: 0 0 10px var(--neon-blue-glow), 0 0 20px var(--neon-blue-glow); }
        .theme-buttons button[data-theme="sunset-glow"]:hover { border-color: var(--neon-orange); box-shadow: 0 0 10px var(--neon-orange-glow), 0 0 20px var(--neon-orange-glow); }
        .theme-buttons button[data-theme="deep-night"]:hover { border-color: var(--neon-pink); box-shadow: 0 0 10px var(--neon-pink-glow), 0 0 20px var(--neon-pink-glow); }
        .theme-buttons button[data-theme="forest-green"]:hover { border-color: var(--neon-green); box-shadow: 0 0 10px var(--neon-green-glow), 0 0 20px var(--neon-green-glow); }


        /* Add Task Input and Button */
        #newTaskInput, #reminderDateInput, #reminderTimeInput {
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-color-light);
            outline: none;
            box-shadow: inset 0 0 5px var(--theme-primary-glow); /* Uses theme glow */
            padding: 0.75rem; /* Tailwind p-3 */
            border-radius: 0.5rem; /* Tailwind rounded-lg */
        }
        #newTaskInput::placeholder, #reminderDateInput::placeholder, #reminderTimeInput::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        #newTaskInput:focus, #reminderDateInput:focus, #reminderTimeInput:focus {
            border-color: var(--theme-primary-neon);
            box-shadow: inset 0 0 8px var(--theme-primary-glow), 0 0 5px var(--theme-primary-glow);
        }
        /* Specific styling for date/time inputs for consistency */
        input[type="date"]::-webkit-calendar-picker-indicator,
        input[type="time"]::-webkit-calendar-picker-indicator {
            filter: invert(1); /* Invert color for dark theme visibility */
            cursor: pointer;
        }

        #addTaskBtn {
            background-color: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--theme-primary-neon);
            color: var(--theme-primary-neon);
            text-shadow: 0 0 5px var(--theme-primary-glow);
            box-shadow: 0 0 8px var(--theme-primary-glow);
            transition: all 0.3s ease;
        }
        #addTaskBtn:hover {
            background-color: var(--theme-primary-neon);
            color: var(--bg-dark-base);
            text-shadow: none;
            box-shadow: 0 0 15px var(--theme-primary-glow), 0 0 25px var(--theme-primary-glow);
            transform: translateY(-2px);
            animation: button-pulse 1.5s infinite; /* Uses theme primary glow */
        }
        #addTaskBtn:active {
            transform: translateY(0);
            box-shadow: 0 0 5px var(--theme-primary-glow);
        }

        /* Filter and Clear Completed Buttons */
        .filter-btn, #clearCompletedBtn {
            background-color: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-color-light);
            transition: all 0.3s ease;
        }
        .filter-btn:hover {
            background-color: rgba(0, 0, 0, 0.6);
            border-color: var(--theme-primary-neon); /* Uses theme primary */
            box-shadow: 0 0 8px var(--theme-primary-glow); /* Uses theme primary glow */
            transform: translateY(-1px);
        }
        .filter-btn[data-active='true'] {
            background-color: var(--theme-primary-neon); /* Uses theme primary */
            color: var(--bg-dark-base);
            border-color: var(--theme-primary-glow); /* Uses theme primary glow */
            box-shadow: 0 0 10px var(--theme-primary-glow);
            text-shadow: none;
        }
        #clearCompletedBtn {
            border-color: var(--theme-secondary-neon); /* Use secondary neon for clear button */
            color: var(--theme-secondary-neon);
            text-shadow: 0 0 5px var(--theme-secondary-glow);
            box-shadow: 0 0 8px var(--theme-secondary-glow);
        }
        #clearCompletedBtn:hover {
            background-color: var(--theme-secondary-neon);
            color: var(--bg-dark-base);
            text-shadow: none;
            box-shadow: 0 0 15px var(--theme-secondary-glow), 0 0 25px var(--theme-secondary-glow);
            transform: translateY(-2px);
            animation: button-pulse 1.5s infinite; /* Uses theme secondary glow */
        }

        /* Task List and Items */
        #taskList {
            color: var(--text-color-light);
            padding-left: 0;
        }
        .task-item {
            background-color: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            animation: fadeInSlideUp 0.4s ease-out; /* New task animation */
            border-radius: 8px; /* Rounded corners for list items */
            margin-bottom: 5px; /* Spacing between tasks */
            padding: 12px 15px; /* More padding */
        }
        .task-item:last-child {
            border-bottom: none;
        }
        .task-item.removing {
            animation: fadeOutSlideRight 0.4s ease-in forwards; /* Deletion animation */
        }
        .task-item .task-text {
            color: var(--theme-primary-neon); /* Uses theme primary */
            text-shadow: 0 0 3px var(--theme-primary-glow); /* Uses theme primary glow */
            transition: all 0.3s ease-in-out;
            font-weight: bold;
        }
        .task-item.completed .task-text {
            text-decoration: line-through;
            color: #9ca3af; /* Grey out completed tasks */
            text-shadow: none; /* Remove neon glow for completed */
            font-style: italic;
        }
        .reminder-info {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.6);
            margin-left: auto;
            text-align: right;
            padding-left: 10px; /* Space from task text */
            flex-shrink: 0; /* Prevent shrinking */
        }
        .reminder-info.overdue {
            color: var(--neon-pink); /* Overdue reminders in pink neon */
            text-shadow: 0 0 5px var(--neon-pink-glow);
        }

        /* Checkbox Neon Effect */
        .task-checkbox {
            appearance: none;
            width: 24px;
            height: 24px;
            border: 2px solid var(--theme-primary-neon); /* Uses theme primary */
            border-radius: 6px;
            background-color: rgba(0, 0, 0, 0.4);
            cursor: pointer;
            position: relative;
            display: inline-block;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 0 5px var(--theme-primary-glow); /* Uses theme primary glow */
        }
        .task-checkbox:checked {
            background-color: var(--theme-primary-neon); /* Use primary for checked color */
            border-color: var(--theme-primary-neon);
            box-shadow: 0 0 10px var(--theme-primary-glow);
        }
        .task-checkbox:checked::after {
            content: 'âœ”';
            color: var(--bg-dark-base); /* Dark checkmark */
            font-size: 18px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-shadow: none;
        }
        /* Animation on check/uncheck */
        .task-checkbox:checked + .task-text,
        .task-checkbox:not(:checked) + .task-text {
             animation: textFlash 0.3s ease-out; /* Brief flash on toggle */
             animation-iteration-count: 1; /* Only play once */
        }

        /* Delete Button Neon Effect (SVG) */
        .delete-btn svg {
            stroke: var(--theme-secondary-neon); /* Use secondary for delete icon */
            filter: drop-shadow(0 0 2px var(--theme-secondary-glow));
            transition: all 0.2s ease-in-out;
        }
        .delete-btn:hover svg {
            stroke: var(--theme-secondary-glow);
            filter: drop-shadow(0 0 5px var(--theme-secondary-glow)) drop-shadow(0 0 10px var(--theme-secondary-glow));
            transform: scale(1.1);
        }

        /* No Tasks Message */
        #noTasksMessage {
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
        }

        /* Custom Message Box Neon Styling */
        #customMessageBox {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        #customMessageBox.show {
            opacity: 1;
            visibility: visible;
        }
        .message-content {
            background-color: rgba(0, 0, 0, 0.9);
            border: 2px solid var(--theme-primary-neon); /* Uses theme primary */
            box-shadow: 0 0 15px var(--theme-primary-glow), 0 0 30px var(--theme-secondary-glow); /* Uses theme primary and secondary */
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            max-width: 400px;
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        #customMessageBox.show .message-content {
            transform: scale(1);
        }
        .message-content p {
            color: var(--text-color-light);
            text-shadow: 0 0 5px var(--theme-primary-glow);
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        #customMessageBox .message-content button {
            background-color: rgba(0, 0, 0, 0.7);
            color: var(--theme-primary-neon); /* Uses theme primary */
            border: 1px solid var(--theme-primary-neon);
            box-shadow: 0 0 8px var(--theme-primary-glow);
            transition: all 0.2s ease-in-out;
            padding: 0.5rem 1rem; /* Tailwind px-4 py-2 */
            border-radius: 0.5rem; /* Tailwind rounded-lg */
        }
        #customMessageBox .message-content button:hover {
            background-color: var(--theme-primary-neon);
            color: var(--bg-dark-base);
            box-shadow: 0 0 15px var(--theme-primary-glow);
        }
        #customMessageBox .message-content #messageCancelBtn {
            border-color: var(--theme-secondary-neon); /* Uses theme secondary */
            color: var(--theme-secondary-neon);
            box-shadow: 0 0 8px var(--theme-secondary-glow);
        }
        #customMessageBox .message-content #messageCancelBtn:hover {
            background-color: var(--theme-secondary-neon);
            color: var(--bg-dark-base);
            box-shadow: 0 0 15px var(--theme-secondary-glow);
        }

        /* --- Theme-Specific Overlays (applied via JS, styled here) --- */
        .theme-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* Allows clicks to pass through */
            z-index: -2; /* Below todo-card::before */
        }
        /* Ocean overlay */
        body.theme-ocean-breeze .theme-overlay {
            background: radial-gradient(circle at 20% 80%, rgba(0, 100, 200, 0.2) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(0, 150, 255, 0.2) 0%, transparent 50%);
            background-size: 300% 300%;
            animation: wave 20s linear infinite;
            opacity: 0.7;
        }
        /* Sunset overlay */
        body.theme-sunset-glow .theme-overlay {
            background: conic-gradient(from 0deg at 50% 50%, 
                        rgba(255, 100, 0, 0.3) 0deg, 
                        rgba(255, 150, 0, 0.1) 45deg, 
                        transparent 90deg, 
                        rgba(255, 150, 0, 0.1) 135deg, 
                        rgba(255, 100, 0, 0.3) 180deg, 
                        transparent 270deg, 
                        rgba(255, 100, 0, 0.3) 360deg);
            animation: sunRay 25s linear infinite;
            opacity: 0.8;
        }
        /* Night overlay */
        body.theme-deep-night .theme-overlay {
            background: 
                radial-gradient(2px 2px at 20% 30%, white, transparent),
                radial-gradient(2px 2px at 75% 80%, white, transparent),
                radial-gradient(2px 2px at 50% 10%, white, transparent),
                radial-gradient(1px 1px at 90% 50%, white, transparent),
                radial-gradient(1px 1px at 10% 60%, white, transparent),
                radial-gradient(1px 1px at 40% 90%, white, transparent);
            background-size: 300px 300px, 400px 400px, 500px 500px, 600px 600px, 700px 700px, 800px 800px;
            animation: twinkle 5s infinite alternate;
            opacity: 0.6;
        }
        /* Forest overlay */
        body.theme-forest-green .theme-overlay {
            top: 0; /* Start particles from top */
            background: 
                radial-gradient(2px 2px at 10% 50%, var(--theme-primary-glow), transparent),
                radial-gradient(2px 2px at 80% 20%, var(--theme-secondary-glow), transparent),
                radial-gradient(3px 3px at 30% 70%, var(--theme-primary-glow), transparent);
            background-size: 100px 100px; /* Smaller particles */
            animation: forestParticles 10s infinite linear;
            opacity: 0.5;
            filter: blur(1px); /* Soft glow */
        }
    </style>
</head>
<body class="theme-ocean-breeze">
    <div class="todo-card">
        <h1 class="text-4xl font-bold text-center mb-6">My Awesome To-Do List</h1>

        <!-- Theme Selection -->
        <div class="mb-6 text-center theme-buttons">
            <span class="text-gray-200 mr-2">Theme:</span>
            <button class="text-xs px-3 py-1 rounded-full mr-1 transition duration-200" data-theme="ocean-breeze">Ocean</button>
            <button class="text-xs px-3 py-1 rounded-full mr-1 transition duration-200" data-theme="sunset-glow">Sunset</button>
            <button class="text-xs px-3 py-1 rounded-full mr-1 transition duration-200" data-theme="deep-night">Night</button>
            <button class="text-xs px-3 py-1 rounded-full transition duration-200" data-theme="forest-green">Forest</button>
        </div>

        <!-- Add New Task and Reminder -->
        <div class="flex flex-col gap-3 mb-6">
            <input 
                type="text" 
                id="newTaskInput" 
                placeholder="Add a new task..." 
                class="flex-grow p-3 rounded-lg border focus:ring-2 focus:ring-blue-500"
            />
            <div class="flex gap-3">
                <input 
                    type="date" 
                    id="reminderDateInput" 
                    class="flex-grow p-3 rounded-lg border focus:ring-2 focus:ring-blue-500"
                    title="Set reminder date"
                />
                <input 
                    type="time" 
                    id="reminderTimeInput" 
                    class="flex-grow p-3 rounded-lg border focus:ring-2 focus:ring-blue-500"
                    title="Set reminder time"
                />
                <button 
                    id="addTaskBtn" 
                    class="px-5 py-2 rounded-lg font-semibold flex-shrink-0"
                >
                    Add Task
                </button>
            </div>
        </div>

        <!-- Filter and Action Buttons -->
        <div class="flex flex-wrap justify-between items-center mb-6 gap-2">
            <div class="flex gap-2">
                <button class="filter-btn px-4 py-2 rounded-lg font-semibold" data-filter="all">All</button>
                <button class="filter-btn px-4 py-2 rounded-lg font-semibold" data-filter="active">Active</button>
                <button class="filter-btn px-4 py-2 rounded-lg font-semibold" data-filter="completed">Completed</button>
            </div>
            <button 
                id="clearCompletedBtn" 
                class="px-4 py-2 rounded-lg font-semibold"
            >
                Clear Completed
            </button>
        </div>

        <!-- Task List -->
        <ul id="taskList" class="divide-y divide-gray-200">
            <!-- Tasks will be dynamically inserted here -->
            <li class="text-gray-500 text-center py-4" id="noTasksMessage">No tasks yet! Add some above.</li>
        </ul>
    </div>

    <!-- Developed by Abhinand AR text (Moved outside the todo-card) -->
    <div class="text-center text-gray-400 text-sm mt-6 opacity-75">
        Developed by Abhinand AR
    </div>

    <!-- Custom Message Box HTML -->
    <div id="customMessageBox">
        <div class="message-content">
            <p id="messageText"></p>
            <div class="flex justify-center gap-4">
                <button id="messageOkBtn" class="px-4 py-2 rounded-lg">OK</button>
                <button id="messageCancelBtn" class="px-4 py-2 rounded-lg hidden">Cancel</button>
            </div>
        </div>
    </div>

    <script type="module">
        // UI Elements
        const newTaskInput = document.getElementById('newTaskInput');
        const reminderDateInput = document.getElementById('reminderDateInput');
        const reminderTimeInput = document.getElementById('reminderTimeInput');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const taskList = document.getElementById('taskList');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const clearCompletedBtn = document.getElementById('clearCompletedBtn');
        const noTasksMessage = document.getElementById('noTasksMessage');

        // Custom Message Box Elements
        const customMessageBox = document.getElementById('customMessageBox');
        const messageText = document.getElementById('messageText');
        const messageOkBtn = document.getElementById('messageOkBtn');
        const messageCancelBtn = document.getElementById('messageCancelBtn');

        let tasks = []; // Local array to hold tasks
        let currentFilter = 'all'; // 'all', 'active', 'completed'
        const LOCAL_STORAGE_KEY = 'todoListTasks';

        // Interval for checking reminders (e.g., every minute)
        const REMINDER_CHECK_INTERVAL = 60 * 1000; // 1 minute in milliseconds
        let reminderCheckerInterval;

        /**
         * Shows a custom message box (modal).
         * @param {string} message The text to display.
         * @param {boolean} isConfirm If true, shows OK and Cancel buttons. Otherwise, just OK.
         * @returns {Promise<boolean>} Resolves true for OK, false for Cancel.
         */
        function showMessage(message, isConfirm = false) {
            return new Promise(resolve => {
                messageText.textContent = message;
                messageCancelBtn.classList.toggle('hidden', !isConfirm);

                // Clear previous listeners
                messageOkBtn.onclick = null;
                messageCancelBtn.onclick = null;

                messageOkBtn.onclick = () => {
                    customMessageBox.classList.remove('show');
                    resolve(true);
                };
                if (isConfirm) {
                    messageCancelBtn.onclick = () => {
                        customMessageBox.classList.remove('show');
                        resolve(false);
                    };
                }
                customMessageBox.classList.add('show');
            });
        }

        /**
         * Saves the current tasks array to local storage.
         */
        function saveTasksToLocalStorage() {
            localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(tasks));
        }

        /**
         * Loads tasks from local storage.
         */
        function loadTasksFromLocalStorage() {
            const storedTasks = localStorage.getItem(LOCAL_STORAGE_KEY);
            if (storedTasks) {
                tasks = JSON.parse(storedTasks);
            } else {
                tasks = [];
            }
            renderTasks();
            startReminderChecker(); // Start checking reminders after loading tasks
        }

        /**
         * Renders tasks to the DOM based on the current filter.
         */
        function renderTasks() {
            taskList.innerHTML = ''; // Clear existing tasks

            const filteredTasks = tasks.filter(task => {
                if (currentFilter === 'all') return true;
                if (currentFilter === 'active') return !task.completed;
                if (currentFilter === 'completed') return task.completed;
                return false;
            });

            if (filteredTasks.length === 0) {
                noTasksMessage.textContent = `No ${currentFilter === 'all' ? '' : currentFilter} tasks.`;
                taskList.appendChild(noTasksMessage);
                noTasksMessage.classList.remove('hidden');
            } else {
                noTasksMessage.classList.add('hidden');
                filteredTasks.forEach(task => {
                    const listItem = document.createElement('li');
                    listItem.className = `task-item flex items-center justify-between py-2 ${task.completed ? 'completed' : ''}`;
                    listItem.dataset.id = task.id; // Use task ID for local management

                    let reminderHtml = '';
                    if (task.reminderDate) {
                        const reminderDateTime = new Date(`${task.reminderDate}T${task.reminderTime || '00:00'}:00`);
                        const now = new Date();
                        const isOverdue = !task.completed && reminderDateTime < now;
                        
                        reminderHtml = `
                            <span class="reminder-info text-xs ml-auto ${isOverdue ? 'overdue' : ''}">
                                ${isOverdue ? 'OVERDUE: ' : 'Remind: '}
                                ${task.reminderDate} ${task.reminderTime || ''}
                            </span>
                        `;
                    }

                    const taskContent = `
                        <div class="flex items-center flex-grow">
                            <input 
                                type="checkbox" 
                                class="task-checkbox mr-3 h-5 w-5 rounded focus:ring-blue-500 border-gray-300 cursor-pointer" 
                                ${task.completed ? 'checked' : ''}
                            />
                            <span class="task-text text-lg break-words flex-grow">${escapeHTML(task.text)}</span>
                        </div>
                        ${reminderHtml}
                        <button class="delete-btn ml-4 p-1 rounded-full">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    `;
                    listItem.innerHTML = taskContent;
                    taskList.appendChild(listItem);
                });
            }

            // Update active filter button styling
            filterButtons.forEach(button => {
                if (button.dataset.filter === currentFilter) {
                    button.setAttribute('data-active', 'true');
                } else {
                    button.setAttribute('data-active', 'false');
                }
            });
        }

        /**
         * Adds a new task.
         */
        async function addTask() {
            const taskText = newTaskInput.value.trim();
            const reminderDate = reminderDateInput.value;
            const reminderTime = reminderTimeInput.value;

            if (taskText === '') {
                showMessage("Task cannot be empty!", false);
                return;
            }

            // Generate a simple unique ID for the task
            const newTaskId = Date.now().toString(); 
            tasks.push({ 
                id: newTaskId, 
                text: taskText, 
                completed: false, 
                createdAt: new Date().toISOString(), // Use ISO string for consistent date storage
                reminderDate: reminderDate || null, // Store date or null
                reminderTime: reminderTime || null  // Store time or null
            });
            newTaskInput.value = ''; // Clear input
            reminderDateInput.value = ''; // Clear date input
            reminderTimeInput.value = ''; // Clear time input

            saveTasksToLocalStorage();
            renderTasks();
            checkReminders(); // Re-check reminders after adding a new task
        }

        /**
         * Toggles the completed status of a task.
         * @param {string} taskId The ID of the task.
         * @param {boolean} currentStatus The current completed status.
         */
        async function toggleTaskComplete(taskId, currentStatus) {
            const taskIndex = tasks.findIndex(task => task.id === taskId);
            if (taskIndex !== -1) {
                tasks[taskIndex].completed = !currentStatus;
                saveTasksToLocalStorage();
                renderTasks(); // Re-render to apply strikethrough/color changes
                checkReminders(); // Re-check reminders after completing a task
            }
        }

        /**
         * Deletes a task.
         * @param {string} taskId The ID of the task.
         */
        async function deleteTask(taskId) {
            const confirmDelete = await showMessage("Are you sure you want to delete this task?", true);
            if (confirmDelete) {
                const listItem = taskList.querySelector(`[data-id="${taskId}"]`);
                if (listItem) {
                    listItem.classList.add('removing'); // Add animation class
                    listItem.addEventListener('animationend', () => {
                        tasks = tasks.filter(task => task.id !== taskId);
                        saveTasksToLocalStorage();
                        renderTasks(); // Re-render after animation completes
                        checkReminders(); // Re-check reminders after deleting a task
                    }, { once: true });
                } else {
                    // Fallback if animation class cannot be applied (e.g., item not visible due to filter)
                    tasks = tasks.filter(task => task.id !== taskId);
                    saveTasksToLocalStorage();
                    renderTasks();
                    checkReminders();
                }
            }
        }

        /**
         * Clears all completed tasks.
         */
        async function clearCompletedTasks() {
            const completedTasks = tasks.filter(task => task.completed);
            if (completedTasks.length === 0) {
                showMessage("No completed tasks to clear!", false);
                return;
            }

            const confirmClear = await showMessage(`Are you sure you want to clear all ${completedTasks.length} completed tasks?`, true);
            if (confirmClear) {
                // Animate removal of each completed task
                const completedListItems = Array.from(taskList.querySelectorAll('.task-item.completed'));
                let animationsCompleted = 0;

                if (completedListItems.length > 0) {
                    completedListItems.forEach(listItem => {
                        listItem.classList.add('removing');
                        listItem.addEventListener('animationend', () => {
                            animationsCompleted++;
                            if (animationsCompleted === completedListItems.length) {
                                tasks = tasks.filter(task => !task.completed);
                                saveTasksToLocalStorage();
                                renderTasks();
                                showMessage("Completed tasks cleared!", false);
                                checkReminders(); // Re-check reminders after clearing tasks
                            }
                        }, { once: true });
                    });
                } else {
                    // Fallback if no items to animate (shouldn't happen if completedTasks.length > 0)
                    tasks = tasks.filter(task => !task.completed);
                    saveTasksToLocalStorage();
                    renderTasks();
                    showMessage("Completed tasks cleared!", false);
                    checkReminders();
                }
            }
        }

        /**
         * Handles clicks on filter buttons.
         * @param {Event} event The click event.
         */
        function handleFilterClick(event) {
            currentFilter = event.target.dataset.filter;
            renderTasks();
        }

        /**
         * Applies the selected theme to the body.
         * @param {string} themeName The name of the theme class (e.g., 'ocean-breeze').
         */
        function applyTheme(themeName) {
            // Remove previous theme-specific overlay if it exists
            const existingOverlay = document.body.querySelector('.theme-overlay');
            if (existingOverlay) {
                existingOverlay.remove();
            }

            document.body.className = ''; // Clear existing theme classes
            document.body.classList.add(`theme-${themeName}`);

            // Add new theme-specific overlay if needed
            const newOverlay = document.createElement('div');
            newOverlay.classList.add('theme-overlay');
            document.body.appendChild(newOverlay);
        }

        /**
         * Escapes HTML to prevent XSS.
         * @param {string} str The string to escape.
         * @returns {string} The escaped string.
         */
        function escapeHTML(str) {
            const div = document.createElement('div');
            div.appendChild(document.createTextNode(str));
            return div.innerHTML;
        }

        /**
         * Checks for overdue reminders and displays notifications.
         */
        function checkReminders() {
            const now = new Date();
            let overdueReminders = [];

            tasks.forEach(task => {
                if (task.reminderDate && !task.completed) {
                    // Combine date and time for a full DateTime object
                    const reminderDateTime = new Date(`${task.reminderDate}T${task.reminderTime || '00:00'}:00`);

                    if (reminderDateTime < now) {
                        // Mark as notified if it hasn't been yet to prevent repeated pop-ups
                        if (!task.notified) {
                            overdueReminders.push(task.text);
                            task.notified = true; // Mark as notified in memory
                        }
                    } else {
                        // Reset notified status if reminder is no longer overdue (e.g., date changed)
                        task.notified = false;
                    }
                }
            });

            // If there are newly overdue reminders, show a message
            if (overdueReminders.length > 0) {
                let message = "Reminder! The following tasks are overdue:\n\n";
                overdueReminders.forEach(taskText => {
                    message += `- ${taskText}\n`;
                });
                showMessage(message, false);
                saveTasksToLocalStorage(); // Save updated 'notified' status
            }
            renderTasks(); // Re-render to update 'overdue' class on displayed tasks
        }

        /**
         * Starts the reminder checking interval.
         */
        function startReminderChecker() {
            // Clear any existing interval to prevent duplicates
            if (reminderCheckerInterval) {
                clearInterval(reminderCheckerInterval);
            }
            // Check reminders immediately and then every X milliseconds
            checkReminders();
            reminderCheckerInterval = setInterval(checkReminders, REMINDER_CHECK_INTERVAL);
        }

        // Event Listeners
        addTaskBtn.addEventListener('click', addTask);
        newTaskInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addTask();
            }
        });
        reminderDateInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addTask();
            }
        });
        reminderTimeInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addTask();
            }
        });


        taskList.addEventListener('click', (e) => {
            const listItem = e.target.closest('.task-item');
            if (!listItem) return; // Not a task item

            const taskId = listItem.dataset.id;
            // Find the task object from the local tasks array
            const task = tasks.find(t => t.id === taskId);
            if (!task) return; // Task not found in local array

            if (e.target.classList.contains('task-checkbox')) {
                toggleTaskComplete(taskId, task.completed);
            } else if (e.target.closest('.delete-btn')) {
                deleteTask(taskId);
            }
        });

        filterButtons.forEach(button => {
            button.addEventListener('click', handleFilterClick);
        });

        clearCompletedBtn.addEventListener('click', clearCompletedTasks);

        // Theme buttons event listeners
        document.querySelectorAll('[data-theme]').forEach(button => {
            button.addEventListener('click', (e) => {
                applyTheme(e.target.dataset.theme);
            });
        });

        // Initialize the app by loading tasks from local storage
        window.onload = () => {
            loadTasksFromLocalStorage();
            // Apply initial theme overlay on load
            // Read the initial theme from the body's class list
            const initialThemeClass = Array.from(document.body.classList).find(cls => cls.startsWith('theme-'));
            if (initialThemeClass) {
                const initialThemeName = initialThemeClass.replace('theme-', '');
                applyTheme(initialThemeName);
            } else {
                applyTheme('ocean-breeze'); // Fallback to a default theme if none is set
            }
        };
    </script>
</body>
</html>